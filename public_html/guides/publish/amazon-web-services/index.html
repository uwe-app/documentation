<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>Amazon Web Services</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Publish a site to Amazon Web Services"><meta name="commit" content="c517f073c475070b85d37ee553f237f28cb953ca"><meta name="generator" content="uwe/0.48.15"><meta name="version" content="1.0.0"><meta name="author" content="Muji (https://tmpfs.org/)"><meta property="og:description" content="Publish a site to Amazon Web Services"><meta property="og:image" content="https://uwe.app/assets/img/social.jpg"><meta property="og:site_name" content="UWE / Universal Web Editor"><meta property="og:title" content="Amazon Web Services"><meta property="og:type" content="website"><meta property="og:url" content="https://uwe.app/docs/guides/publish/amazon-web-services/"><link rel="stylesheet" href="../../../../assets/plugins/std::alert/styles/alert.css"><link rel="stylesheet" href="../../../../assets/plugins/std::crumbtrail/styles/crumbtrail.css"><link rel="stylesheet" href="../../../../assets/plugins/std::menu/styles/menu.css"><link rel="stylesheet" href="../../../../assets/plugins/std::sidebar/styles/sidebar.css"><link rel="stylesheet" href="../../../../assets/plugins/uwe::brand::main/site/assets/styles/standard.css"><link rel="stylesheet" href="../../../../assets/plugins/uwe::brand::syntax/site/assets/styles/syntax.css"><link rel="icon" href="data:image/gif;base64,R0lGODlhEAAQAAAAACwAAAAAAQABAAACASgAOw=="><link rel="stylesheet" href="../../../../assets/styles/main.css"><link rel="manifest" href="../../../../app.webmanifest"><link rel="canonical" href="https://uwe.app/docs/guides/publish/amazon-web-services/"></head><body><input id="sidebar-toggle" type="checkbox" checked><aside id="sidebar"><div><header><label for="sidebar-toggle"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></label></header><section><nav><p><a href="../../../" title="Documentation">Docs</a> / <a href="../../../guides/" title="Guides">Guides</a> / <a href="../../../guides/publish/" title="Publish">Publish</a></p><ul><li><a href="../../../guides/publish/self-hosting/" title="Self Hosting">Self Hosting</a></li><li class='selected'><a href="../../../guides/publish/amazon-web-services/" title="Amazon Web Services">Amazon Web Services</a></li></ul></nav></section><footer><p><a
  target="_blank"
  href="https://github.com/uwe-app/website/edit/main/site/docs/guides/publish/amazon-web-services.md"
   title="Edit on Github">Edit on Github</a></p><small><a href="https://uwe.app" title="Made by Universal Web Editor" style="text-decoration: none; font-size: 12px;">MADE BY UWE</a> (uwe/0.48.15)</small></footer></div></aside><main><header><nav><a href="../../../" class="header-logotype"></a></nav><label for="sidebar-toggle"><span>Menu</span>&nbsp;<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></label></header><article><h1 id="amazon-web-services">Amazon Web Services</h1><nav class="crumbtrail"><a href="../../../../" title="Universal Web Editor">UWE</a><a href="../../../" title="Documentation and developer reference">Documentation</a><a href="../../" title="How to guides">Guides</a><a href="../" title="Publish the site">Publish</a>Amazon Web Services
</nav><p>Before publishing to an S3 bucket be aware that the default behavior for publishing is a <em>sync operation</em> which means that files in the bucket which do not exist in the local build directory <strong>will be deleted</strong>; for more information on how to change this see <a href="#keep-remote">how to keep remote files</a>.</p><h2 id="credentials">Credentials</h2><p>Before you can publish using <a href="https://aws.amazon.com/">Amazon Web Services</a> you must configure credentials; we use the standard profile credentials to publish so if you have used the <code>aws</code> command line tools this should be familiar.</p><p>Edit the <code>~/.aws/credentials</code> file to set the access key and secret access key:</p><pre><code class="language-toml code"><span class="source toml"><span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">example-credentials</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">aws_access_key_id</span></span> <span class="punctuation definition key-value toml">=</span> <span class="invalid illegal value toml">XXXX</span>
<span class="meta tag key toml"><span class="entity name tag toml">aws_secret_access_key</span></span> <span class="punctuation definition key-value toml">=</span> <span class="invalid illegal value toml">XXXX</span>
</span></code></pre><p>We recommend that the credentials you assign have access to S3 and Cloudfront.</p><h2 id="settings">Settings</h2><p>Now you can configure the publish settings in <code>site.toml</code> to reference those credentials:</p><pre><code class="language-toml code"><span class="source toml"><span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">region</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>us-east-1<span class="punctuation definition string end toml">&quot;</span></span>
<span class="meta tag key toml"><span class="entity name tag toml">credentials</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>example-credentials<span class="punctuation definition string end toml">&quot;</span></span>

<span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">environments</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">stage</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">bucket</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>stage.example.com<span class="punctuation definition string end toml">&quot;</span></span>

<span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">environments</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">production</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">bucket</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>example.com<span class="punctuation definition string end toml">&quot;</span></span>
</span></code></pre><p>You need to ensure that the region matches where your buckets are located and the buckets must already exist, have public read permissions and be configured for static website hosting using <code>index.html</code> for the index page and <code>404.html</code> for the error page.</p><div class="alert"><p>If no bucket is given for an environment it inherits the value from the <code>host</code> setting.</p></div><p>Afterwards you can publish an environment like this:</p><pre><code>uwe publish stage
</code></pre><p>It is not required to have a <code>stage</code> environment but is recommended so you can check the published site before going live. Once you have verified the staging site; to publish to production just specify the <code>production</code> environment:</p><pre><code>uwe publish production
</code></pre><h2 id="keep-remote">Keep Remote</h2><p>Publishing to an AWS S3 bucket is a <em>sync operation</em> so files that do not exist locally will be deleted from the remote bucket when the <code>publish</code> command runs. Normally this is what you want if the bucket is <strong>only</strong> being used for static website hosting however if you are storing other files in the bucket publishing would delete those files as they are not part of the website. In this situation you should use the <code>keep-remote</code> option for the environment settings, for example:</p><pre><code class="language-toml code"><span class="source toml"><span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">environments</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">production</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">bucket</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>example.com<span class="punctuation definition string end toml">&quot;</span></span>
<span class="meta tag key toml"><span class="entity name tag toml">keep-remote</span></span> <span class="punctuation definition key-value toml">=</span> <span class="constant language toml">true</span>
</span></code></pre><p>When <code>keep-remote</code> is enabled files are not deleted from the bucket when publishing which means that you will need to remove stale website files manually.</p><p>An example of this is the <a href="https://releases.uwe.app">releases web page</a> which is a bucket containing binary executables for the software releases and an index page showing the available releases. The <a href="https://github.com/uwe-app/releases-website/">releases website</a> does not delete the remote files otherwise the executables which are published separately would be removed!</p><h2 id="prefix">Prefix</h2><p>You can set a <code>prefix</code> to publish into a particular location in the bucket.</p><div class="alert warn"><span class="label">warn</span><p>Be aware that this configuration has issues with trailing slash redirects when proxied via Cloudfront so we recommend a separate bucket per environment.</p></div><pre><code class="language-toml code"><span class="source toml"><span class="meta tag key toml"><span class="entity name tag toml">host</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>example.com<span class="punctuation definition string end toml">&quot;</span></span>

<span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">region</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>us-east-1<span class="punctuation definition string end toml">&quot;</span></span>
<span class="meta tag key toml"><span class="entity name tag toml">credentials</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>example-credentials<span class="punctuation definition string end toml">&quot;</span></span>

<span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">environments</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">stage</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">prefix</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>stage<span class="punctuation definition string end toml">&quot;</span></span>

<span class="punctuation definition table begin toml">[</span><span class="meta tag table toml"><span class="entity name table toml">publish</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">aws</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">environments</span><span class="punctuation separator table toml">.</span><span class="entity name table toml">production</span></span><span class="punctuation definition table end toml">]</span>
<span class="meta tag key toml"><span class="entity name tag toml">prefix</span></span> <span class="punctuation definition key-value toml">=</span> <span class="string quoted double basic toml"><span class="punctuation definition string begin toml">&quot;</span>production<span class="punctuation definition string end toml">&quot;</span></span>
</span></code></pre><h2 id="redirects">Redirects</h2><p>An exception to the default sync behavior is the handling of redirects which is a merge operation that attempts to preserve older redirects in the bucket. The reason for preserving redirects is that as you update your site and change <code>permalink</code> values it is better that people's bookmarks are still respected whenever possible.</p><p>Consider a page that has a <code>permalink</code> of <code>/article-name/</code> and a destination of <code>/posts/article-name/</code>; when the site is published a redirect will be created from the permalink to the destination URL.</p><p>Any person that visits the page and creates a bookmark will be using the permalink which redirects to the article URL. Now if you decide to change the permalink to <code>/new-article-name/</code> and publish a new version of the site the old redirect will continue to work!</p><p>If you want to remove old redirects from the bucket use the <code>--sync-redirects</code> option (<code>keep-remote</code> should not be enabled) and the redirects will mirror the local copy, for example:</p><pre><code class="language-text">uwe publish --sync-redirects stage
</code></pre><p><a href=".." title="Publish">Back to Publish</a></p></article><footer><div><p>Last updated Thu Feb 11 2021</p></div></footer></main></body></html>